梯度 [https://www.zhihu.com/tardis/bd/ans/1827501472](https://www.zhihu.com/tardis/bd/ans/1827501472)

一个直观的例子，在机器学习领域有个术语叫「梯度下降」，你可以想象在群山之中，某个山的半山腰有只小兔子打算使用梯度下降的思路去往这片群山最深的山谷里找水喝。



虽然东南西北各个方向都有变化率，但梯度下降的思想就是通过梯度最快的收敛，而梯度就是这几个方向中变化率最大的**方向和值**（为什么最大后面会说明），注意梯度同时描述了两个值，方向和大小，是个向量。放在这里，梯度就是东边和一百颗星。

机器学习领域，我们有一个步长（记为 

<iframe src="https://www.zhihu.com/equation?tex=%5Cgamma&consumer=ZHI_MENG"/>

 ，发音 gamma 通常取值在 0 - 1 之间）是人为设定的值，它与梯度（记为 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla&consumer=ZHI_MENG"/>

 ，发音 grad）相乘，就可以描述小兔子每蹦跶一下该往某个方向跳以及一下跳了多远了。

一元函数

刚才的例子也说了变化率描述山路的陡峭程度，放在函数里，描述函数变化率的东东就是函数的**导数**。在一元函数里，我们的函数就是从左到右的一根线，方向已经固定了，没有东南西北可言，所以**对于一元函数而言，函数** 

<iframe src="https://www.zhihu.com/equation?tex=f(x)&consumer=ZHI_MENG"/>

 **在** 

<iframe src="https://www.zhihu.com/equation?tex=a&consumer=ZHI_MENG"/>

 **点处的梯度，等于该函数的导数在** 

<iframe src="https://www.zhihu.com/equation?tex=a&consumer=ZHI_MENG"/>

 **点处的值，即** 

<iframe src="https://www.zhihu.com/equation?tex=f'(a)&consumer=ZHI_MENG"/>

 ，**记为** 

<iframe src="https://www.zhihu.com/equation?tex=f'(a)+=+%5Cnabla+f%7C_a&consumer=ZHI_MENG"/>

 。说白了就是方向上没得选，于是梯度直接等于导数。

![](https://pic3.zhimg.com/v2-3a93d21ce730d577e64a063fdfe07190_b.webp?consumer=ZHI_MENG)

							一元函数的图像就是根从左到右的线

在一元函数里，因为只有一个方向，所以直接使用导数就可以描述变化率了。而在多元函数里，就像在一开始的例子中，我们的小兔子是可以往东南西北甚至更多的方向蹦跶的，是个 3D 游戏。而每个方向山路的陡峭程度不一样，于是就需要引入**方向导数**的概念。**方向导数**描述了函数图像在指定方向上的陡峭程度，也可以说成函数图像在指定方向上的变化率，**是个数值**。根据之前小兔子的例子，我们很容易猜出来，此时的**梯度**（又叫**梯度向量**）**就是所有方向中变化率最大的方向和值，它同时描述了值和方向，是个向量。**

## 数学符号预警！

接下来用数学语言解释一下为什么梯度就是所有方向中变化率最大的那个向量，然后在观赏下所有教程中都会甩出来的经典梯度公式。

**单位向量，梯度，方向导数**

**单位向量：**单位向量是长度或者模为 1 的向量，在这里用来描述方向导数的方向，记作 

<iframe src="https://www.zhihu.com/equation?tex=+%5Ctextbf%7Bu%7D+&consumer=ZHI_MENG"/>

 ，它各个分量的平方和再开根号的值是 1。例如：单位向量 

<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bu%7D+=+%3Cu_1,+u_2,+u_3......u_n%3E&consumer=ZHI_MENG"/>

 那么它的模（记作 

<iframe src="https://www.zhihu.com/equation?tex=%5Cleft%7C+%5Ctextbf%7Bu%7D+%5Cright%7C&consumer=ZHI_MENG"/>

），有

<iframe src="https://www.zhihu.com/equation?tex=%5Cleft%7C+%5Ctextbf%7Bu%7D+%5Cright%7C+=+%5Csqrt%5B2%5D%7Bu%5E2_1+u%5E2_2++u%5E2_3++....+u%5E2_n%7D+=+1&consumer=ZHI_MENG"/>

。

**梯度：** 函数 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

 的**梯度**，记作 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla+f&consumer=ZHI_MENG"/>

 ，是由求 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

 在对求各个参数求偏导而得到的向量，即: 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla+f+=+%3C%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+x_1%7D,+%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+x_2%7D,...%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+x_n%7D%3E&consumer=ZHI_MENG"/>

 ， 其中 

<iframe src="https://www.zhihu.com/equation?tex=x_1,x_2...x_n&consumer=ZHI_MENG"/>

 是多元函数 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

 的参数，将点 

<iframe src="https://www.zhihu.com/equation?tex=P+=+(p_1,+p_2...p_n)+&consumer=ZHI_MENG"/>

 带入 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla+f&consumer=ZHI_MENG"/>

 中能得到函数 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

 在 

<iframe src="https://www.zhihu.com/equation?tex=P&consumer=ZHI_MENG"/>

点的梯度，记做 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla+f%7C_%7BP%7D&consumer=ZHI_MENG"/>

 。

**方向导数：函数  在点  处的朝着方向  的方向导数**，记作（ 

<iframe src="https://www.zhihu.com/equation?tex=D_%7B%5Ctextbf%7Bu%7DP%7D+f&consumer=ZHI_MENG"/>

 ）。是梯度和单位向量 

<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bu%7D&consumer=ZHI_MENG"/>

 的点积，即 

<iframe src="https://www.zhihu.com/equation?tex=D_%7B%5Ctextbf%7Bu%7DP%7D+f+=+%5Cnabla+f%7C_%7BP%7D+%5Cbullet+%5Ctextbf%7Bu%7D&consumer=ZHI_MENG"/>

 ，是个数值，用来描述函数 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

 在点 

<iframe src="https://www.zhihu.com/equation?tex=P&consumer=ZHI_MENG"/>

 处的朝着方向 

<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bu%7D&consumer=ZHI_MENG"/>

 的变化率。

**梯度和方向导数的关系**

> 根据上面对方向导数的描述，我们使用高中的向量相乘的知识，能得到梯度和方向导数有如下关系：  

> 
<iframe src="https://www.zhihu.com/equation?tex=D_%7B%5Ctextbf%7Bu%7DP%7D+f+=+%5Cnabla+f%7C_%7BP%7D+%5Cbullet+%5Ctextbf%7Bu%7D+=+%5Cleft%7C+%5Cnabla+f%7C_%7BP%7D+%5Cright%7C+%5Cleft%7C+%5Ctextbf%7Bu%7D+%5Cright%7C+cos%5Ctheta+=+%5Cleft%7C+%5Cnabla+f%7C_%7BP%7D+%5Cright%7C++cos%5Ctheta&consumer=ZHI_MENG"/>
> 
>   
这里的 
> 
<iframe src="https://www.zhihu.com/equation?tex=%5Ctheta+&consumer=ZHI_MENG"/>
> 
>  是 
> 
<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bu%7D&consumer=ZHI_MENG"/>
> 
>  和梯度之间的夹角，单位向量的模等于 1

上面的公式看上去虽然比较丑，但揭示的东西显而易见：

1. 当 

<iframe src="https://www.zhihu.com/equation?tex=cos(%5Ctheta)&consumer=ZHI_MENG"/>

    等于 1 时也就是方向导数的方向 

<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bu%7D&consumer=ZHI_MENG"/>

    和梯度的夹角为 0 时，有 

<iframe src="https://www.zhihu.com/equation?tex=D_%7BuP%7D+f+=+%5Cleft%7C+%5Cnabla+f%7C_%7BP%7D+%5Cright%7C+&consumer=ZHI_MENG"/>

    ，此时该方向导数的值最大，我们得出了最经典的结论「**函数** 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

    **在** 

<iframe src="https://www.zhihu.com/equation?tex=P&consumer=ZHI_MENG"/>

    **处沿着其梯度的方向增加最快**」，这就是梯度下降中指导我们收敛的规律。

2. 当 

<iframe src="https://www.zhihu.com/equation?tex=cos(%5Ctheta)&consumer=ZHI_MENG"/>

    等于 -1 时也就是 

<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bu%7D&consumer=ZHI_MENG"/>

    与梯度的夹角为 

<iframe src="https://www.zhihu.com/equation?tex=%5Cpi&consumer=ZHI_MENG"/>

    时，有 

<iframe src="https://www.zhihu.com/equation?tex=D_%7BuP%7D+f+=+-%5Cleft%7C+%5Cnabla+f%7C_%7BP%7D+%5Cright%7C+&consumer=ZHI_MENG"/>

    ，我们得出结论「函数 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

    在 

<iframe src="https://www.zhihu.com/equation?tex=p_0&consumer=ZHI_MENG"/>

    处沿着其梯度相反的方向减少最快」。

3. 当 

<iframe src="https://www.zhihu.com/equation?tex=cos(%5Ctheta)&consumer=ZHI_MENG"/>

    等于 0 时也就是 

<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bu%7D&consumer=ZHI_MENG"/>

    与梯度垂直时，有 

<iframe src="https://www.zhihu.com/equation?tex=D_%7BuP%7D+f+=+0&consumer=ZHI_MENG"/>

    ，我们得出「函数 

<iframe src="https://www.zhihu.com/equation?tex=f&consumer=ZHI_MENG"/>

    在 

<iframe src="https://www.zhihu.com/equation?tex=P&consumer=ZHI_MENG"/>

    处沿着其梯度垂直方向上的变化率为 0」。


## 常见梯度公式  的由来

接下来我们看一下很多教程中都会甩出来的梯度公式 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla+f+=+%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+x%7D%5Ctextbf%7Bi%7D+++%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+y%7D%5Ctextbf%7Bj%7D&consumer=ZHI_MENG"/>

 的前世今生。

有二元函数 

<iframe src="https://www.zhihu.com/equation?tex=f(x,y)&consumer=ZHI_MENG"/>

 ，

根据梯度的定义，那么它的梯度是 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla+f+=+%3C%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+x%7D%5Ctextbf+,+%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+y%7D%5Ctextbf%3E&consumer=ZHI_MENG"/>

向量标准化后 

<iframe src="https://www.zhihu.com/equation?tex=%5Cnabla+f+=+%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+x%7D%5Ctextbf%7Bi%7D+++%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+y%7D%5Ctextbf%7Bj%7D&consumer=ZHI_MENG"/>

 ，这里 

<iframe src="https://www.zhihu.com/equation?tex=%5Ctextbf%7Bi%7D+=+%3C1,0%3E&consumer=ZHI_MENG"/>

 , 

<iframe src="https://www.zhihu.com/equation?tex=+%5Ctextbf%7Bj%7D+=+%3C0,1%3E&consumer=ZHI_MENG"/>

 ，就得到了这个公式。